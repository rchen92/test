SQL> set head off
SQL> SELECT UTL_INADDR.GET_HOST_ADDRESS,
  2  SYS_CONTEXT('userenv', 'ip_address')
  3  FROM DUAL;

172.16.6.12                                                                     
172.18.1.37                                                                     
                                                                                

SQL> /*
SQL> CREATE DATABASE LINK dgs
SQL>  CONNECT TO system
SQL>  IDENTIFIED BY B0x_sYsteM27
SQL>  USING '(DESCRIPTION=
SQL> 	 (ADDRESS=
SQL> 	   (PROTOCOL=TCP)
SQL> 	   (HOST=172.16.2.1)
SQL> 	   (PORT=1521)
SQL> 	 )
SQL> 	 (CONNECT_DATA=
SQL> 	   (SERVICE_NAME=o11gr2dg)
SQL> 	 )
SQL>   )';
SQL> CREATE DATABASE LINK dgp
SQL>  CONNECT TO system
SQL>  IDENTIFIED BY B0x_sYsteM27
SQL>  USING '(DESCRIPTION=
SQL> 	 (ADDRESS=
SQL> 	   (PROTOCOL=TCP)
SQL> 	   (HOST=172.16.2.2)
SQL> 	   (PORT=1521)
SQL> 	 )
SQL> 	 (CONNECT_DATA=
SQL> 	   (SERVICE_NAME=o11gr2)
SQL> 	 )
SQL>   )';
SQL>   */
SQL> CREATE TABLESPACE dat_dg DATAFILE
  2    '/data01/oradata/oflbox01/dat_dg01.dbf ' SIZE 10m AUTOEXTEND ON NEXT 1280K MAXSIZE UNLIMITED
  3  LOGGING
  4  ONLINE
  5  EXTENT MANAGEMENT LOCAL AUTOALLOCATE
  6  BLOCKSIZE 8K
  7  SEGMENT SPACE MANAGEMENT AUTO
  8  FLASHBACK ON;
CREATE TABLESPACE dat_dg DATAFILE
*
第 1 行出现错误: 
ORA-01543: 表空间 'DAT_DG' 已存在 


SQL> 
SQL> select * from dba_data_files@dgs where TABLESPACE_NAME='DAT_DG';

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

/data01/oradata/oflbox01/dat_dg01.dbf                                           
         6 DAT_DG                                                               
  10485760       1280 AVAILABLE                     6 YES    3.4360E+10         
   4194302          160    9437184        1152 ONLINE                           
                                                                                

SQL> 
SQL> --在备库切换日志
SQL> alter system switch logfile;

系统已更改。

SQL> select sequence# from v$archived_log@dgs;

        10                                                                      
         9                                                                      
        11                                                                      
         8                                                                      
         6                                                                      
         7                                                                      
         5                                                                      
        12                                                                      
        13                                                                      
        14                                                                      
        15                                                                      
        16                                                                      
        16                                                                      

        17                                                                      
        17                                                                      
        18                                                                      
        18                                                                      
        19                                                                      
        19                                                                      

已选择19行。

SQL> alter system switch logfile;

系统已更改。

SQL> select sequence# from v$archived_log@dgs;

        10                                                                      
         9                                                                      
        11                                                                      
         8                                                                      
         6                                                                      
         7                                                                      
         5                                                                      
        12                                                                      
        13                                                                      
        14                                                                      
        15                                                                      
        16                                                                      
        16                                                                      

        17                                                                      
        17                                                                      
        18                                                                      
        18                                                                      
        19                                                                      
        19                                                                      
        20                                                                      
        20                                                                      
        21                                                                      
        21                                                                      

已选择23行。

SQL> --在主库进行验证：
SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> select sequence#,applied from v$archived_log@dgp;

         4 NO                                                                   
         5 YES                                                                  
         6 YES                                                                  
         7 YES                                                                  
         8 YES                                                                  
         9 YES                                                                  
        10 YES                                                                  
        10 YES                                                                  
        11 YES                                                                  
         9 YES                                                                  
        11 YES                                                                  
         8 YES                                                                  
         6 YES                                                                  

         7 YES                                                                  
         5 YES                                                                  
        12 YES                                                                  
        12 YES                                                                  
        13 YES                                                                  
        13 YES                                                                  
        14 YES                                                                  
        14 NO                                                                   
        15 YES                                                                  
        15 NO                                                                   
        16 YES                                                                  
        17 YES                                                                  
        18 YES                                                                  

        19 YES                                                                  
        20 YES                                                                  
        21 IN-MEMORY                                                            

已选择29行。

SQL> select   current_scn from v$database@dgp
  2  union all
  3  select   current_scn from v$database@dgs;

  132900941                                                                     
  132900943                                                                     

SQL> --drop tablespace dat_dg including contents and datafiles;
SQL> 
SQL> create user dg identified by dg default tablespace dat_dg;
create user dg identified by dg default tablespace dat_dg
            *
第 1 行出现错误: 
ORA-01920: 用户名 'DG' 与另外一个用户名或角色名发生冲突 


SQL> grant connect,resource to dg;

授权成功。

SQL> alter user dg quota unlimited on dat_dg;

用户已更改。

SQL> SELECT * FROM DBA_USERS WHERE USERNAME='DG';

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

DG                                                                   86         
                                                                                
OPEN                                                                            
04-5月 -14     DAT_DG                                                           
TEMP01                                                       05-11月-13         
DEFAULT                                                                         
DEFAULT_CONSUMER_GROUP                                                          
                                                                                
10G 11G          N  PASSWORD                                                    
                                                                                

SQL> conn dg/dg@OFLBOX01DG
已连接。
SQL> 
SQL> create table big_table tablespace dat_dg
  2  as
  3  select rownum id, a.*
  4    from all_objects a
  5   where 1=2
  6  ;

表已创建。

SQL> declare
  2  	 l_cnt number;
  3  	 l_rows number := 10000;
  4  begin
  5  	 insert /* append */
  6  	 into big_table
  7  	 select rownum, a.*
  8  	   from all_objects a
  9  	  where rownum <= l_rows;
 10  
 11  	 l_cnt := sql%rowcount;
 12  
 13  	 commit;
 14  
 15  	 while (l_cnt < l_rows)
 16  	 loop
 17  	     insert /* APPEND */ into big_table
 18  	     select rownum+l_cnt,
 19  		    OWNER, OBJECT_NAME, SUBOBJECT_NAME,
 20  		    OBJECT_ID, DATA_OBJECT_ID,
 21  		    OBJECT_TYPE, CREATED, LAST_DDL_TIME,
 22  		    TIMESTAMP, STATUS, TEMPORARY,
 23  		    GENERATED, SECONDARY,namespace,edition_name
 24  	       from big_table
 25  	      where rownum <= l_rows-l_cnt;
 26  	     l_cnt := l_cnt + sql%rowcount;
 27  	     commit;
 28  	 end loop;
 29  end;
 30  /

PL/SQL 过程已成功完成。

SQL> 
SQL> conn sys/iBoxPay_301B@OFLBOX01DG as sysdba
已连接。
SQL> select count(1) from dg.big_table@dgs
  2  union all
  3  select count(1) from dg.big_table@dgP;

     10000                                                                      
         0                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

     10000                                                                      
         0                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

     10000                                                                      
         0                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

     10000                                                                      
         0                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

     10000                                                                      
         0                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

     10000                                                                      
         0                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

     10000                                                                      
         0                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

     10000                                                                      
     10000                                                                      

SQL> 
SQL> 
SQL> spool off
