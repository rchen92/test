SQL> set head off
SQL> SELECT UTL_INADDR.GET_HOST_ADDRESS,
  2  SYS_CONTEXT('userenv', 'ip_address')
  3  FROM DUAL;

172.16.6.11                                                                     
172.18.1.37                                                                     
                                                                                

SQL> /*
SQL> CREATE DATABASE LINK dgs
SQL>  CONNECT TO system
SQL>  IDENTIFIED BY iBoxPay_301B
SQL>  USING '(DESCRIPTION=
SQL> 	 (ADDRESS=
SQL> 	   (PROTOCOL=TCP)
SQL> 	   (HOST=172.16.6.12)
SQL> 	   (PORT=1521)
SQL> 	 )
SQL> 	 (CONNECT_DATA=
SQL> 	   (SERVICE_NAME=oflbox01dg)
SQL> 	 )
SQL>   )';
SQL> CREATE DATABASE LINK dgp
SQL>  CONNECT TO system
SQL>  IDENTIFIED BY iBoxPay_301B
SQL>  USING '(DESCRIPTION=
SQL> 	 (ADDRESS=
SQL> 	   (PROTOCOL=TCP)
SQL> 	   (HOST=172.16.6.11)
SQL> 	   (PORT=1521)
SQL> 	 )
SQL> 	 (CONNECT_DATA=
SQL> 	   (SERVICE_NAME=oflbox01)
SQL> 	 )
SQL>   )';
SQL> CREATE TABLESPACE dat_txy DATAFILE
SQL>   '/data01/oradata/oflbox01/dat_txy01.dbf ' SIZE 10m AUTOEXTEND ON NEXT 1280K MAXSIZE UNLIMITED
SQL> LOGGING
SQL> ONLINE
SQL> EXTENT MANAGEMENT LOCAL AUTOALLOCATE
SQL> BLOCKSIZE 8K
SQL> SEGMENT SPACE MANAGEMENT AUTO
SQL> FLASHBACK ON;
SQL> 
SQL> select * from dba_data_files@dgs where TABLESPACE_NAME='DAT_TXY';
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> 
SQL> --在主库切换日志
SQL> alter system switch logfile;
SQL> select sequence# from v$archived_log;
SQL> alter system switch logfile;
SQL> select sequence# from v$archived_log;
SQL> --在备库进行验证：
SQL> exec dbms_lock.sleep(1);
SQL> select sequence#,applied from v$archived_log@dgs;
SQL> 
SQL> --drop tablespace dat_txy including contents and datafiles;
SQL> 
SQL> create user txy identified by txy default tablespace dat_txy;
SQL> grant connect,resource to txy;
SQL> alter user txy quota unlimited on dat_txy;
SQL> SELECT * FROM DBA_USERS WHERE USERNAME='TXY';
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> exec dbms_lock.sleep(1);
SQL> /
SQL> */
SQL> conn txy/txy@OFLBOX01
已连接。
SQL> 
SQL> create table big_table tablespace dat_txy
  2  as
  3  select rownum id, a.*
  4    from all_objects a
  5   where 1=2
  6  ;

表已创建。

SQL> declare
  2  	 l_cnt number;
  3  	 l_rows number := 100000;
  4  begin
  5  	 insert /* append */
  6  	 into big_table
  7  	 select rownum, a.*
  8  	   from all_objects a
  9  	  where rownum <= l_rows;
 10  
 11  	 l_cnt := sql%rowcount;
 12  
 13  	 commit;
 14  
 15  	 while (l_cnt < l_rows)
 16  	 loop
 17  	     insert /* APPEND */ into big_table
 18  	     select rownum+l_cnt,
 19  		    OWNER, OBJECT_NAME, SUBOBJECT_NAME,
 20  		    OBJECT_ID, DATA_OBJECT_ID,
 21  		    OBJECT_TYPE, CREATED, LAST_DDL_TIME,
 22  		    TIMESTAMP, STATUS, TEMPORARY,
 23  		    GENERATED, SECONDARY,namespace,edition_name
 24  	       from big_table
 25  	      where rownum <= l_rows-l_cnt;
 26  	     l_cnt := l_cnt + sql%rowcount;
 27  	     commit;
 28  	 end loop;
 29  end;
 30  /

PL/SQL 过程已成功完成。

SQL> 
SQL> conn sys/iBoxPay_301B@OFLBOX01 as sysdba
已连接。
SQL> select count(1) from txy.big_table@dgp
  2  union all
  3  select count(1) from txy.big_table@dgs;

    100000                                                                      
     56281                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

    100000                                                                      
     56281                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

    100000                                                                      
     56281                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

    100000                                                                      
    100000                                                                      

SQL> exec dbms_lock.sleep(1);

PL/SQL 过程已成功完成。

SQL> /

    100000                                                                      
    100000                                                                      

SQL> exec dbms_lock.sleep(5);

PL/SQL 过程已成功完成。

SQL> /

    100000                                                                      
    100000                                                                      

SQL> exec dbms_lock.sleep(5);

PL/SQL 过程已成功完成。

SQL> /

    100000                                                                      
    100000                                                                      

SQL> exec dbms_lock.sleep(5);

PL/SQL 过程已成功完成。

SQL> /

    100000                                                                      
    100000                                                                      

SQL> 
SQL> 
SQL> spool off
