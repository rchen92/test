Datagard重建
p
sqlplus / as sysdba
create pfile='/archive/backup/dgbackup/init_o11gr2.ora.old' from spfile;
alter database create standby controlfile as '/archive/backup/dgbackup/stdby_control01_o11gr2.ctl';
BACKUP
    incremental level=0
    SKIP INACCESSIBLE
    FILESPERSET 10
    # recommended format
    FORMAT '/archive/backup/dgbackup/diskdb0_T.%T_s.%s_d.%d'
    DATABASE;
--s mkdir -p /archive/backup/dgbackup
chown -R oracle.oinstall /archive
ls /archiv*
scp -rp /archive/backup/dgbackup  oracle@172.16.2.1://archive/backup

rman target / auxiliary sys/B0x_sYsteM27@O11GR2DG
duplicate target database for standby;
s
ALTER DATABASE RECOVER MANAGED STANDBY DATABASE cancel;
alter database open read only;
ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE disconnect;

















rman target / auxiliary sys/sys@orcldg
ORA-12528: TNS: 监听程序: 所有适用例程都无法建立新连接

duplicate target database for standby from active database dorecover nofilenamecheck;
duplicate target database for standby nofilenamecheck;


duplicate target database for standby ;
alter database open read only;
alter database open read only
*
ERROR at line 1:
ORA-10458: standby database requires recovery
ORA-01194: 文件 1 需要更多的恢复来保持一致性
ORA-01110: 数据文件 1: '/oracle/oradata/orcldg/system01.dbf'
ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE disconnect;
开始日志应用（从传输的完全备份开始），要耗时很久。改善方法：在duplicate target database for standby nofilenamecheck之前，主库做一次全备，
并把备份scp到备库(不用传归档日志，control file用 alter database create standby controlfile as ‘/ora/dd.ctl’,then scp)。
/oracle/fast_recovery_area/1_298_810128218.dbf
select thread#,NAME, SEQUENCE#,to_char(RESETLOGS_TIME,'yyyy/mm/dd hh24:mi:ss') RESETLOGS_TIME,NEXT_CHANGE#, to_char(NEXT_TIME,'yyyy/mm/dd hh24:mi:ss') NEXT_TIME,
a.RESETLOGS_CHANGE#,FIRST_CHANGE#,first_TIME,APPLIED,creator,REGISTRAR,STANDBY_DEST,ARCHIVED,DELETED,STATUS from v$archived_log a  
where first_TIME is not null order by SEQUENCE# desc,name;
cd /oracle/fast_recovery_area/

ALTER DATABASE RECOVER MANAGED STANDBY DATABASE cancel;
alter database open read only;
ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE disconnect;
已用时间:  00: 00: 03.44

  COUNT(*)
----------
   3000000
   2339936

已用时间:  00: 00: 43.72
SQL> /

  COUNT(*)
----------
   3000000
   3000000

已用时间:  00: 00: 00.31
