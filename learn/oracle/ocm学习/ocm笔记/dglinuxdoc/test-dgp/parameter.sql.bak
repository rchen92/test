system/B0x_sYsteM27@aix
spool .\result\dg.log
SET ECHO ON
set head off
SELECT UTL_INADDR.GET_HOST_ADDRESS, 
SYS_CONTEXT('userenv', 'ip_address')
FROM DUAL;
CREATE DATABASE LINK dgs
 CONNECT TO system
 IDENTIFIED BY B0x_sYsteM27
 USING '(DESCRIPTION=
    (ADDRESS=
      (PROTOCOL=TCP)
      (HOST=172.16.2.1)
      (PORT=1521)
    )
    (CONNECT_DATA=
      (SERVICE_NAME=o11gr2dg)
    )
  )';
CREATE DATABASE LINK dgp
 CONNECT TO system
 IDENTIFIED BY B0x_sYsteM27
 USING '(DESCRIPTION=
    (ADDRESS=
      (PROTOCOL=TCP)
      (HOST=172.16.2.2)
      (PORT=1521)
    )
    (CONNECT_DATA=
      (SERVICE_NAME=o11gr2)
    )
  )';
CREATE TABLESPACE dat_txy DATAFILE 
  '/data/oradata/o11gr2/dat_txy01.dbf ' SIZE 10m AUTOEXTEND ON NEXT 1280K MAXSIZE UNLIMITED
LOGGING
ONLINE
EXTENT MANAGEMENT LOCAL AUTOALLOCATE
BLOCKSIZE 8K
SEGMENT SPACE MANAGEMENT AUTO
FLASHBACK ON;

select * from dba_data_files@dgs where TABLESPACE_NAME='DAT_TXY';
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/


--drop tablespace dat_txy including contents and datafiles;

create user txy identified by txy default tablespace dat_txy;
grant connect,resource to txy;
alter user txy quota unlimited on dat_txy;
SELECT * FROM DBA_USERS WHERE USERNAME='TXY';
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
conn txy/txy@aix

create table big_table tablespace dat_txy
as
select rownum id, a.*
  from all_objects a
 where 1=2
;
declare
    l_cnt number;
    l_rows number := 1000;
begin
    insert /* append */
    into big_table
    select rownum, a.*
      from all_objects a
     where rownum <= l_rows;

    l_cnt := sql%rowcount;

    commit;

    while (l_cnt < l_rows)
    loop
        insert /* APPEND */ into scott.big_table
        select rownum+l_cnt,
               OWNER, OBJECT_NAME, SUBOBJECT_NAME,
               OBJECT_ID, DATA_OBJECT_ID,
               OBJECT_TYPE, CREATED, LAST_DDL_TIME,
               TIMESTAMP, STATUS, TEMPORARY,
               GENERATED, SECONDARY,namespace,edition_name
          from big_table
         where rownum <= l_rows-l_cnt;
        l_cnt := l_cnt + sql%rowcount;
        commit;
    end loop;
end;
/


select count(1) from big_table
union all
select count(1) from big_table@dgs;
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/
exec dbms_lock.sleep(1);
/


spool off
exit
