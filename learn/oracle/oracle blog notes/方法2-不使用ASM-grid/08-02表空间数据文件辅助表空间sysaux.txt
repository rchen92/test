sysaux
备份
#演示有备份的恢复



sysaux --> system axuiliary
	表空间的名字不能更改，不能删除，不能read only，能够脱机，但脱机后sysaux的工具程序不能使用了
	备份
		必须在归档模式下，通过热备或者rman备份
			热备：
				alter tablespace sysaux begin backup;
				ho cp /u01/app/oracle/oradata/orcl/sysaux01.dbf /backup/
				alter tablespace sysaux end backup;
			rman备：
				rman target /
				RMAN> backup tablespace sysaux;
		非归档模式，冷备，不研究
	sysaux损坏或者丢失
		有备份，能恢复
			先还原，再恢复
		没有备份
			只能offline，然后将内容迁移到新库中去


SQL> desc v$sysaux_occupants
 Name					   Null?    Type
 ----------------------------------------- -------- ----------------------------
 OCCUPANT_NAME					    VARCHAR2(64)
 OCCUPANT_DESC					    VARCHAR2(64)
 SCHEMA_NAME					    VARCHAR2(64)
 MOVE_PROCEDURE 				    VARCHAR2(64)
 MOVE_PROCEDURE_DESC				    VARCHAR2(64)
 SPACE_USAGE_KBYTES				    NUMBER
SQL> select occupant_name,schema_name from v$sysaux_occupants;		#脱机后，这里面的功能可能就会受到限制了
SQL> col occupant_name for a20
SQL> col schema_name for a20
SQL> /
OCCUPANT_NAME		  SCHEMA_NAME
------------------------- --------------------
LOGMNR			  SYSTEM
LOGSTDBY		  SYSTEM
SMON_SCN_TIME		  SYS
PL/SCOPE		  SYS
STREAMS 		  SYS
AUDIT_TABLES		  SYS
XDB			  XDB
AO			  SYS
XSOQHIST		  SYS
XSAMD			  OLAPSYS
SM/AWR			  SYS

OCCUPANT_NAME		  SCHEMA_NAME
------------------------- --------------------
SM/ADVISOR		  SYS
SM/OPTSTAT		  SYS
SM/OTHER		  SYS
STATSPACK		  PERFSTAT
SDO			  MDSYS
WM			  WMSYS
ORDIM			  ORDSYS
ORDIM/ORDDATA		  ORDDATA
ORDIM/ORDPLUGINS	  ORDPLUGINS
ORDIM/SI_INFORMTN_SCHEMA  SI_INFORMTN_SCHEMA
EM			  SYSMAN

OCCUPANT_NAME		  SCHEMA_NAME
------------------------- --------------------
TEXT			  CTXSYS
ULTRASEARCH		  WKSYS
ULTRASEARCH_DEMO_USER	  WK_TEST
EXPRESSION_FILTER	  EXFSYS
EM_MONITORING_USER	  DBSNMP
TSM			  TSMSYS
SQL_MANAGEMENT_BASE	  SYS
AUTO_TASK		  SYS
JOB_SCHEDULER		  SYS

SQL> select tablespace_name,file_name from dba_data_files where file_name like '%sysaux%';
TABLESPACE_NAME		FILE_NAME
----------------	-------------------------------------------------------------------------------
SYSAUX				/u01/app/oracle/oradata/orcl/sysaux01.dbf
SQL> ho cp /u01/app/oracle/oradata/orcl/sysaux01.dbf /backup/
SQL> alter tablespace sysaux end backup;

RMAN> backup tablespace sysaux;
Starting backup at 04-NOV-16
using target database control file instead of recovery catalog
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=43 device type=DISK
channel ORA_DISK_1: starting full datafile backup set
channel ORA_DISK_1: specifying datafile(s) in backup set
input datafile file number=00002 name=/u01/app/oracle/oradata/orcl/sysaux01.dbf
channel ORA_DISK_1: starting piece 1 at 04-NOV-16
channel ORA_DISK_1: finished piece 1 at 04-NOV-16
piece handle=/u01/app/oracle/flash_recovery_area/ORCL/backupset/2016_11_04/o1_mf_nnndf_TAG20161104T101314_d1qvowg1_.bkp tag=TAG20161104T101314 comment=NONE
channel ORA_DISK_1: backup set complete, elapsed time: 00:00:35
Finished backup at 04-NOV-16

#演示有备份的恢复
[oracle@oracle ~]$ rm -rf /u01/app/oracle/oradata/orcl/sysaux01.dbf
SQL> startup;
ORACLE instance started.
Total System Global Area  534462464 bytes
Fixed Size		    2215064 bytes
Variable Size		  406848360 bytes
Database Buffers	  121634816 bytes
Redo Buffers		    3764224 bytes
Database mounted.
ORA-01157: cannot identify/lock data file 2 - see DBWR trace file
ORA-01110: data file 2: '/u01/app/oracle/oradata/orcl/sysaux01.dbf'			#报sysaux文件2丢失的错误
SQL> ho cp /backup/sysaux01.dbf /u01/app/oracle/oradata/orcl/sysaux01.dbf		#先还原
SQL> alter database open;
alter database open
*
ERROR at line 1:
ORA-01113: file 2 needs media recovery
ORA-01110: data file 2: '/u01/app/oracle/oradata/orcl/sysaux01.dbf'
SQL> recover datafile 2;		#恢复
Media recovery complete.
SQL> alter database open;		#可以打开了
Database altered.

[oracle@oracle ~]$ rm -rf /u01/app/oracle/oradata/orcl/sysaux01.dbf
SQL> startup;
ORACLE instance started.
Total System Global Area  534462464 bytes
Fixed Size		    2215064 bytes
Variable Size		  406848360 bytes
Database Buffers	  121634816 bytes
Redo Buffers		    3764224 bytes
Database mounted.
ORA-01157: cannot identify/lock data file 2 - see DBWR trace file
ORA-01110: data file 2: '/u01/app/oracle/oradata/orcl/sysaux01.dbf'			#报sysaux文件2丢失的错误
RMAN> restore tablespace sysaux;			#还原
Starting restore at 04-NOV-16
using target database control file instead of recovery catalog
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=20 device type=DISK
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00002 to /u01/app/oracle/oradata/orcl/sysaux01.dbf
channel ORA_DISK_1: reading from backup piece /u01/app/oracle/flash_recovery_area/ORCL/backupset/2016_11_04/o1_mf_nnndf_TAG20161104T101314_d1qvowg1_.bkp
channel ORA_DISK_1: piece handle=/u01/app/oracle/flash_recovery_area/ORCL/backupset/2016_11_04/o1_mf_nnndf_TAG20161104T101314_d1qvowg1_.bkp tag=TAG20161104T101314
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:35
Finished restore at 04-NOV-16
RMAN> recover tablespace sysaux;		#恢复
Starting recover at 04-NOV-16
using channel ORA_DISK_1
starting media recovery
media recovery complete, elapsed time: 00:00:01
Finished recover at 04-NOV-16
RMAN> alter database open;			#能够启动了
database opened















