#热备
#RMAN备
#现在u3使用的是users1表空间，且没有备份。（自己建立的用户表空间可以使用以下方法恢复，短时间）
删除RMAN备
RMAN> DELETE BACKUPSET 1;



users  默认的用户表空间
管理 ---> 如何指定默认表空间
	 ---> users备份、恢复
		热备，rman备

SQL>  SELECT * FROM database_properties where property_name like '%DEF%';
PROPERTY_NAME		       PROPERTY_VALUE  DESCRIPTION
------------------------------ --------------- ----------------------------------------
DEFAULT_TEMP_TABLESPACE        TEMP	       Name of default temporary tablespace
DEFAULT_PERMANENT_TABLESPACE   USERS	       Name of default permanent tablespace		#默认的用户表空间
DEFAULT_EDITION 	       ORA$BASE        Name of the database default edition
DEFAULT_TBS_TYPE	       SMALLFILE       Default tablespace type
SQL> CREATE TABLESPACE users1 DATAFILE '/u01/app/oracle/oradata/orcl/user1.dbf' SIZE 100M AUTOEXTEND ON;
#修改默认用户表空间
SQL> ALTER DATABASE DEFAULT TABLESPACE users1;
SQL> SELECT * FROM database_properties where property_name like '%DEF%';
PROPERTY_NAME		       PROPERTY_VALUE  DESCRIPTION
------------------------------ --------------- ----------------------------------------
DEFAULT_TEMP_TABLESPACE        TEMP	       Name of default temporary tablespace
DEFAULT_PERMANENT_TABLESPACE   USERS1	       Name of default permanent tablespace		#现在默认的用户表空间是USERS1了
DEFAULT_EDITION 	       ORA$BASE        Name of the database default edition
DEFAULT_TBS_TYPE	       SMALLFILE       Default tablespace type
SQL> ALTER DATABASE DEFAULT TABLESPACE USERS;			#还是修改回来

#指定单个用户的用户表空间
SQL> CREATE USER u2 IDENTIFIED BY u2 DEFAULT TABLESPACE users1;
SQL> CREATE USER u3 IDENTIFIED BY u3;
SQL> SELECT USERNAME,DEFAULT_TABLESPACE FROM DBA_USERS;
USERNAME		       DEFAULT_TABLESPACE
------------------------------ ------------------------------
MGMT_VIEW		       SYSTEM
SYS			       SYSTEM
SYSTEM			       SYSTEM
DBSNMP			       SYSAUX
SYSMAN			       SYSAUX
SCOTT			       USERS
U3			       USERS
T1			       T01
U2			       USERS1


#热备
SQL> ALTER TABLESPACE users BEGIN BACKUP;
Tablespace altered.
SQL> ho cp /u01/app/oracle/oradata/orcl/users01.dbf /backup/users01.dbf.bak
SQL> ALTER TABLESPACE users END BACKUP;

#RMAN备
RMAN> BACKUP TABLESPACE users;

#
SQL> ho rm /u01/app/oracle/oradata/orcl/users01.dbf
SQL> ALTER DATABASE DATAFILE 4 OFFLINE;
SQL> ho cp /backup/users01.dbf /u01/app/oracle/oradata/orcl/
SQL> ALTER TABLESPACE users online;			#这个时候会报错，需要介质恢复
SQL> RECOVER TABLESPACE users;
SQL> ALTER TABLESPACE users online;			#现在好了

#
SQL> ho rm /u01/app/oracle/oradata/orcl/users01.dbf
SQL> ALTER DATABASE DATAFILE 4 OFFLINE;
RMAN> RESTORE TABLESPACE users;
RMAN> RECOVER TABLESPACE users;
RMAN> sql 'ALTER TABLESPACE users online' ;	

#现在u3使用的是users1表空间，且没有备份。（自己建立的用户表空间可以使用以下方法恢复，短时间）
[oracle@oracle ~]$ rm -rf /u01/app/oracle/oradata/user1.dbf
SQL> select file_name,file_id,tablespace_name from dba_data_files
FILE_NAME					 FILE_ID TABLESPACE_NAME
--------------------------------------------- ---------- ------------------------------
/u01/app/oracle/oradata/orcl/users01.dbf	       4 USERS
/u01/app/oracle/oradata/orcl/undotbs1.dbf	       3 UNDOTBS1
/u01/app/oracle/oradata/orcl/system01.dbf	       1 SYSTEM
/u01/app/oracle/oradata/orcl/sysaux01.dbf	       2 SYSAUX
/u01/app/oracle/oradata/orcl/example01.dbf	       5 EXAMPLE
/u01/app/oracle/oradata/orcl/undotbs02.dbf	       6 UNDOTBS02
/u01/app/oracle/oradata/orcl/user1.dbf		       7 USERS1
SQL> ALTER TABLESPACE users1 offline;		#会报错
SQL> ALTER DATABASE DATAFILE 7 OFFLINE;
SQL> ALTER DATABASE CREATE DATAFILE 7 AS '/u01/app/oracle/oradata/orcl/user1.dbf';
SQL> RECOVER TABLESPACE users1;
SQL> ALTER TABLESPACE users1 ONLINE;




删除RMAN备
RMAN> DELETE BACKUPSET 1;






