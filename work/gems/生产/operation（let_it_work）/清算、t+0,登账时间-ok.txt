--query  登录后线库
--清算时间
select '清算时间' time,
       extract(hour from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       extract(minute from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       round(extract(second from
                     max(t.f_update_timestamp) - min(t.f_create_timestamp))) everyday_clear_time
  from cln_user.t_cln_run_log t
 where f_log_id =
       (select max(f_log_id)
          from cln_user.t_cln_run_log t
         where t.f_flag = 1
           and t.f_settle_date =
               (select max(t.f_settle_date) from par_user.t_par_settle_date t))
union all
--t+0财务处理时间
select 't+0财务处理时间' time,
       extract(hour from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       extract(minute from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       round(extract(second from
                     max(t.f_update_timestamp) - min(t.f_create_timestamp))) everyday_clear_time
  from cln_user.t_cln_run_log t
 where f_log_id =
       (select max(f_log_id)
          from cln_user.t_cln_run_log t
         where f_flag = 3
           and t.f_settle_date =
               (select max(t.f_settle_date) from par_user.t_par_settle_date t))
union all
--登账前清算时间
select '登账前清算时间' time,
       extract(hour from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       extract(minute from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       round(extract(second from
                     max(t.f_update_timestamp) - min(t.f_create_timestamp))) everyday_clear_time
  from cln_user.t_cln_run_log t
 where f_log_id =
       (select max(f_log_id)
          from cln_user.t_cln_run_log t
         where f_flag = 4
           and t.f_settle_date =
               (select max(t.f_settle_date) from par_user.t_par_settle_date t))
union all
--日终登账时间
select '日终登账时间' time,
       extract(hour from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       extract(minute from
               max(t.f_update_timestamp) - min(t.f_create_timestamp)) || ':' ||
       round(extract(second from
                     max(t.f_update_timestamp) - min(t.f_create_timestamp))) everyday_clear_time
  from cln_user.t_cln_run_log t
 where f_log_id =
       (select max(f_log_id)
          from cln_user.t_cln_run_log t
         where f_flag = 5
           and t.f_settle_date =
               (select max(t.f_settle_date) from par_user.t_par_settle_date t));
