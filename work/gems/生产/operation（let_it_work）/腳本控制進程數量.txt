!/bin/sh

##control only one Process running 
##按需修改pid文件
pidfile=/var/run/impdp.pid
if [ ! -f $pidfile ]; then
  touch $pidfile
fi
pid_f=`cat $pidfile`

if [ "$pid_f"x != "x" ]; then
  echo "process is running, now I exit."
  exit 1
fi
echo $$ > $pidfile
##


chk_file="/root/finish.out"

while :
do
 if [ -f $chk_file ]; then
    grep -q "ok" $chk_file
    if [[ $? -eq 0 ]]; then
      echo "file exists and contain ok"
      sh /root/controlquantity.sh
      rm $chk_file
      break
    else
      echo "not contain ok,sleep 30"
      sleep 30
    fi         
 else
   echo "file not exits,sleep 30"
   sleep 30  
 fi
done


##clearthe pidfile
echo  > $pidfile




















